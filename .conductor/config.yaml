# Test configuration for conductor
max_concurrency: 10
timeout: 12h
log_level: info
verbose: false
log_dir: .conductor/logs
dry_run: false

# Console output configuration
console:
  # Color output control: auto, true, false
  # auto = detect based on TTY
  colors_enabled: auto

# Quality control configuration
quality_control:
  enabled: true
  # review_agent: conductor-qc # DEPRECATED: use agents section below
  retry_on_red: 2

  # Multi-agent QC configuration (v2.2+)
  # Supports parallel reviews from multiple specialized agents
  agents:
    # Mode: "auto", "explicit", "mixed", or "intelligent"
    # - auto: automatically select agents based on task file types
    # - explicit: use only the agents in explicit_list
    # - mixed: auto-select + additional agents from additional list
    # - intelligent: Claude-based selection analyzing task context (v2.4+)
    mode: intelligent

    # Explicit agent list (used when mode=explicit)
    # Example: [conductor-qc, golang-pro, code-reviewer]
    explicit_list: []

    # Additional agents to add to auto-selection (used when mode=mixed)
    # Example: [security-auditor] - always include security review
    additional: []

    # Agents to never use (for any mode)
    # Example: [deprecated-agent]
    blocked: []

    # Intelligent selection settings (v2.4+)
    # Used when mode=intelligent for Claude-based agent recommendations
    max_agents: 4 # Maximum number of QC agents to select
    cache_ttl_seconds: 3600 # Cache TTL for intelligent selection results (1 hour)
    require_code_review: true # Always include code-reviewer as baseline

# Feedback system configuration (v2.1+)
# Controls how agent and QC outputs are stored for learning and visibility
feedback:
  # Storage locations - enable both for redundancy
  store_in_plan_file: true # Write feedback to plan files (human-readable)
  store_in_database: true # Write feedback to database (long-term learning)

  # Output format - agents return structured responses
  format: json # Only 'json' supported

  # What to store for each verdict
  store_on_green: true # Store full output for successful tasks
  store_on_red: true # Store full output for failed tasks
  store_on_yellow: true # Store full output for tasks with warnings

# Learning system configuration
# Tracks task execution history and adapts future executions based on patterns
learning:
  # Enable/disable the learning system (default: true)
  # When false, no execution history is recorded
  enabled: true

  # Database file path for storing execution history (default: .conductor/learning/executions.db)
  # SQLite database will be created at this location
  db_path: .conductor/learning/executions.db

  # Automatically switch agents after repeated failures (default: false)
  # When true, conductor will change agents based on success patterns
  auto_adapt_agent: true

  # Swap agents DURING retries (v2.1+, default: true)
  # When true, agent swap happens within same run after min_failures_before_adapt threshold
  # When false, swap only occurs on next run (original behavior)
  swap_during_retries: true

  # Add context from past executions to task prompts (default: true)
  # Enriches prompts with relevant failure patterns and tried approaches
  enhance_prompts: true

  # QC context loading (v2.1+)
  # Controls what context QC agent reads before reviewing
  qc_reads_plan_context: true # Load execution history from plan file
  qc_reads_db_context: true # Load execution history from database
  max_context_entries: 10 # Limit context to last N attempts

  # Number of failures before suggesting alternative agent (default: 2)
  # Threshold for triggering agent adaptation recommendations
  min_failures_before_adapt: 2

  # Days to retain execution history before cleanup (default: 90)
  # Set to 0 to keep history forever
  keep_executions_days: 90

  # Maximum execution records to keep per task (default: 100)
  # Prevents database from growing unbounded for frequently-run tasks
  max_executions_per_task: 100

# Agent Watch behavioral analytics configuration (v2.7+)
# Provides observability into Claude Code agent sessions
agent_watch:
  # Enable/disable Agent Watch analytics (default: true)
  enabled: true

  # Base directory for discovering Claude Code session files
  # Default: ~/.claude/projects
  base_dir: "~/.claude/projects"

  # Default number of sessions/entries to display in observe commands
  default_limit: 100

  # Poll interval in seconds for real-time activity streaming
  poll_interval_secs: 2

  # Auto-import new session data into learning database
  auto_import: false

  # Maximum number of sessions to cache in memory (LRU cache)
  cache_size: 50

  # Cost model pricing per 1M tokens (for cost calculations)
  cost_model:
    sonnet_input: 3.0
    sonnet_output: 15.0
    haiku_input: 0.80
    haiku_output: 4.0
    opus_input: 15.0
    opus_output: 75.0

# Plan validation configuration
# Controls strictness of plan file validation
validation:
  # How to handle key_point vs success_criteria misalignment
  # Options:
  #   - warn: Log a warning but continue (default)
  #   - strict: Fail validation if key_points exceed success_criteria
  #   - off: Disable the check entirely
  key_point_criteria: warn

# Task execution configuration (v2.9+)
# Controls behavior during task execution - runtime enforcement
executor:
  # Run dependency check commands before agent invocation (default: true)
  # Tasks with runtime_metadata.dependency_checks execute before agent
  # Task aborted if any check command fails (exits non-zero)
  enforce_dependency_checks: true

  # Run test commands after agent output but before QC review (default: true)
  # With QC enabled: soft gate - task retries with feedback (v2.10+)
  # Without QC: hard gate - task fails immediately
  enforce_test_commands: true

  # Run optional per-criterion verification commands (default: true)
  # Soft signal - failures feed into QC prompt, don't block execution
  verify_criteria: true

  # Enforce runtime package conflict guard for Go packages (default: true)
  # Prevents concurrent tasks from modifying same Go package
  enforce_package_guard: true

  # Enforce documentation target verification (default: true)
  # Verifies agents edit exact sections specified in plan
  enforce_doc_targets: true

  # Enable error pattern detection on test failures (default: true)
  # When enabled, Conductor will analyze test command failures and categorize them
  # into CODE_LEVEL (agent can fix), PLAN_LEVEL (plan needs update), or ENV_LEVEL
  # (environment issue). Provides actionable suggestions for each category.
  enable_error_pattern_detection: true

  # Enable Claude-based error classification (v2.11+, default: false)
  # When enabled, uses Claude to semantically analyze error messages for more accurate
  # classification. Falls back to regex patterns on timeout/error/low confidence.
  # Confidence threshold: 0.85 minimum (filters low-quality classifications)
  enable_claude_classification: true
