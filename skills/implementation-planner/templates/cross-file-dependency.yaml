# Cross-File Dependency Template
# For split plans with dependencies between files

# EXAMPLE: plan-02-integration.yaml
# Demonstrates all cross-file dependency patterns

conductor:
  default_agent: general-purpose
  quality_control:
    enabled: true
    agents:
      mode: auto

plan:
  metadata:
    feature_name: "Feature Name"
    created: "YYYY-MM-DD"

  context:
    framework: "Framework name"
    architecture: "Pattern"

  tasks:
    # ==============================================
    # PATTERN 1: Same-File Dependency Only
    # ==============================================
    - task_number: 6
      name: "Task with same-file dependency"
      agent: "agent-name"
      files:
        - "path/to/file1.ext"
      depends_on:
        - 5    # Same file - numeric reference
        - 4    # Same file - numeric reference
      estimated_time: "30m"

      success_criteria:
        - "Criterion 1"
      test_commands:
        - "test command"

      code_quality:
        go:
          full_quality_pipeline:
            command: "go test ./..."
            exit_on_failure: true

    # ==============================================
    # PATTERN 2: Cross-File Dependency Only
    # ==============================================
    - task_number: 7
      name: "Task depending on another file"
      agent: "agent-name"
      files:
        - "path/to/file2.ext"
      depends_on:
        # Cross-file dependency: depends on Task 2 from foundation file
        - file: "plan-01-foundation.yaml"
          task: 2
      estimated_time: "45m"

      success_criteria:
        - "Integration point established"
      test_commands:
        - "integration test"

      code_quality:
        go:
          full_quality_pipeline:
            command: "go test ./..."
            exit_on_failure: true

    # ==============================================
    # PATTERN 3: Mixed Dependencies (Same + Cross)
    # ==============================================
    - task_number: 8
      name: "Task with both same-file and cross-file deps"
      agent: "agent-name"
      files:
        - "path/to/file3.ext"
      depends_on:
        # Same file dependencies (numeric)
        - 6
        - 7
        # Cross-file dependencies (object notation)
        - file: "plan-01-foundation.yaml"
          task: 5    # Depends on Task 5 from foundation
        - file: "plan-01-foundation.yaml"
          task: 3    # Multiple deps from same file OK

      estimated_time: "60m"

      success_criteria:
        - "All dependencies integrated correctly"
      test_commands:
        - "full test suite"

      code_quality:
        go:
          full_quality_pipeline:
            command: "go test ./..."
            exit_on_failure: true

    # ==============================================
    # PATTERN 4: Multiple Cross-File Dependencies
    # ==============================================
    - task_number: 9
      name: "Coordination task across multiple files"
      agent: "agent-name"
      files:
        - "path/to/coordination.ext"
      depends_on:
        # Dependencies from multiple files
        - file: "plan-01-foundation.yaml"
          task: 5
        - file: "plan-01-foundation.yaml"
          task: 7
        - file: "plan-03-testing.yaml"
          task: 2
        # Plus same-file
        - 8

      estimated_time: "90m"

      success_criteria:
        - "Cross-file coordination working"
      test_commands:
        - "e2e test"

      code_quality:
        go:
          full_quality_pipeline:
            command: "go test ./..."
            exit_on_failure: true

    # ==============================================
    # PATTERN 5: Integration Task with Cross-Deps
    # ==============================================
    - task_number: 10
      type: integration    # Mark integration tasks
      name: "Wire multiple components"
      agent: "agent-name"
      files:
        - "path/to/integration.ext"
      depends_on:
        - file: "plan-01-foundation.yaml"
          task: 4
        - file: "plan-02-integration.yaml"
          task: 8
        - file: "plan-03-testing.yaml"
          task: 5

      # Integration tasks need BOTH criteria types
      success_criteria:
        - "Component 1 initialized"
        - "Component 2 initialized"

      integration_criteria:
        - "Components communicate correctly"
        - "Error handling flows end-to-end"

      test_commands:
        - "integration test suite"

      code_quality:
        go:
          full_quality_pipeline:
            command: "go test ./..."
            exit_on_failure: true

---

# ==============================================
# REFERENCE: Common Cross-File Patterns
# ==============================================

# Pattern A: Foundation + Feature Chain
# plan-01-foundation.yaml:
#   Task 1 → Task 2 → Task 3
# plan-02-features.yaml:
#   Task 4 (depends on plan-01:Task 3)
#   Task 5 (depends on Task 4)
# Execution: 1 → 2 → 3 → 4 → 5

# Pattern B: Parallel + Sync
# plan-01-service-a.yaml:
#   Task 1 → Task 2
# plan-02-service-b.yaml:
#   Task 3 → Task 4
# plan-03-integration.yaml:
#   Task 5 (depends on plan-01:Task 2, plan-02:Task 4)
# Execution: Waves 1 (Task 1, 3) → Wave 2 (Task 2, 4) → Wave 3 (Task 5)

# Pattern C: Cascading Dependencies
# plan-01-db.yaml: Task 1, 2
# plan-02-auth.yaml: Task 3 (depends on plan-01:Task 2)
# plan-03-api.yaml: Task 4 (depends on plan-02:Task 3, plan-01:Task 1)
# plan-04-deploy.yaml: Task 5 (depends on plan-03:Task 4)

---

# ==============================================
# VALIDATION CHECKLIST
# ==============================================

# Before finalizing your cross-file dependencies, verify:

# Syntax Validation:
#   ☐ All cross-file deps use {file: "...", task: N} format
#   ☐ File paths are relative (no directory prefixes)
#   ☐ File names include .yaml or .yml extension
#   ☐ Task numbers are valid integers
#   ☐ All numeric refs are for same-file only

# Reference Validation:
#   ☐ All referenced files exist
#   ☐ All referenced tasks exist in their files
#   ☐ No typos in file names
#   ☐ No circular dependencies (including cross-file)

# Logical Validation:
#   ☐ Dependencies make architectural sense
#   ☐ Dependent task appears after dependencies
#   ☐ Cross-file deps reflect actual module boundaries
#   ☐ Integration tasks have both criteria types

# File Organization:
#   ☐ All files in same directory
#   ☐ Files follow plan-NN-description.yaml pattern
#   ☐ Each file has valid conductor + plan sections
#   ☐ File ordering makes sense to reader
